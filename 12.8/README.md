# Домашнее задание к занятию "`12.8. «Резервное копирование баз данных»`" - `Вахрамеев А.В.`


### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

`Ответ:`

Делать полный бэкап каждый день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

`Ответ:`

Делать инкрементный бэкап каждый час.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

`Ответ:`

Думаю можно использовать репликацию master-slave.

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

`Ответ:`

`Пример pg_dump`

```
pg_dump pgsql_db > /tmp/pgsql_db.sql
```

`Пример pg_restore`

```
pg_restore -U postgres -Ft -C -d testdb < testdb.tar

-C, —create — создание базы данных перед запуском процесса восстановления

-F <формат>, —format=формат — формат резервной копии. Допустимые форматы:

p, plain — формирует текстовый SQL-скрипт;
c, custom — формирует резервную копию в архивном формате;
d, directory — формирует копию в directory-формате;
t, tar — формирует копию в формате tar.
```

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

`Ответ:`

Да, процесс резервирования и восстановления данных можно автоматизировать с помощью скриптов, которые будут запускать указанные выше команды.

`Пример:`

```
#!/usr/bin/bash

PGPASSWORD=some_password
export PGPASSWORD
pathB=/mnt/backup
dbUser=dbadmin
database=pgsql_db


pg_dump -U $dbUser $database | gzip > $pathB/pgsql_$(date "+%Y-%m-%d").sql.gz


unset PGPASSWORD
```
---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

`Ответ:`

```
 $ mysqlbackup --defaults-file=/home/dbadmin/.my.cnf --incremental \
  --incremental-base=dir:/incr-backup/wednesday \
  --incremental-backup-dir=/incr-backup/thursday \
  backup
...many lines of output...
mysqlbackup: Backup created in directory '/incr-backup/thursday'
mysqlbackup: start_lsn: 2654255717
mysqlbackup: incremental_base_lsn: 2666733462
mysqlbackup: end_lsn: 2666736714

101208 17:14:58 mysqlbackup: mysqlbackup completed OK!
```

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

---

Задания, помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.
